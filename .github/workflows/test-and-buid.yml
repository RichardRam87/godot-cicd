name: ğŸ® Test and Build

on:
  workflow_dispatch:
    inputs:
      godot-version-long:
        required: true
        type: string
        default: '4.3.0'
      godot-version-short:
        required: true
        type: string
        default: '4.3'
      export-name:
        required: true
        type: string
        default: 'Game Title'
      project-path:
        required: false
        type: string
        default: '.' # NOTE: If your `project.godot` is at the repository root, set `PROJECT_PATH` below to ".".
      build-type:
        type: choice
        description: debug or release build
        options:
          - debug
          - release
        
permissions:
  checks: write
  contents: read



jobs:
  test:
    name: ğŸ§ª Run Tests
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4
      
      - name: ğŸ§ª Execute Tests
        uses: ./.github/actions/godot-run-tests
        with:
          godot-version: ${{ inputs.godot-version-short }}
        
  build:
    name: ğŸ”¨ Build Game
    needs: [test]
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4

      - name: ğŸ› ï¸ Build Project
        uses: ./.github/actions/godot-create-build
        with:
          godot-version: ${{ inputs.godot-version-godot-version-long }}
          export-name: ${{ inputs.export-name }}
          build-type: ${{ inputs.build-type }}
          project-path: ${{ inputs.project-path }}
      
      - name: ğŸ“¦ Upload Build Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: windows-${{ inputs.build-type }}
          path: build/windows 

